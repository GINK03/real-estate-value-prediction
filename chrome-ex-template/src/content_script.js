//----
function get_model_tokyo() {
	let defs = `__intercept__,10.621059400395449
madori:4LDK,8.944883711578456
detail_position:港区,7.452438085752155
madori:3LDK,5.737813842646272
detail_position:渋谷区,5.551439730295727
detail_position:千代田区,4.970563919857076
detail_position:目黒区,3.847939026479744
madori:5LDK,3.3590024019041937
detail_position:中央区,3.269229084080726
shuunou:ウォークインクローゼット,3.2133667089233087
madori:2LDK,2.9358533934768136
detail_position:新宿区,2.142727025961592
detail_position:品川区,1.8264807894541877
detail_position:世田谷区,1.7320386739806501
detail_position:文京区,1.4243096856301802
secure:宅配ボックス,1.1255281610799812
kouzou:木造（2×4),0.9954428466064356
kaisou:4階以上,0.9749445315214248
shuunou:クローゼット,0.834597434543141
chikunen:10,0.8334095449706466
detail_position:豊島区,0.8285993644410762
chikunen:30,-0.0038310153262207203
madori:3DK,-0.018725826607206113
detail_position:三鷹市,-0.030465068514671713
position:最上階,-0.036317707026152314
chikunen:20,-0.03728108028234185
kouzou:鉄骨ALC造,-0.05261171854885066
detail_position:西多摩郡日の出町,-0.09254411730203255
communication:インターネット接続,-0.15229034125557409
kaisou:1,-0.1916048681953941
kaisou:2,-0.2170161861080145
kouzou:鉄骨造,-0.21975388085454048
detail_position:調布市,-0.2857191103339406
chikunen:50,-0.2900593398685229
chikunen:35,-0.3145948553488358
kitchen:ガスコンロ,-0.36013020499800064
other:置き場,-0.36510006048479837
detail_position:国立市,-0.3700143541818775
secure:インターホン,-0.3717568934378133
detail_position:練馬区,-0.39350904017143734
kouzou:木造,-0.4040841512006783
communication:BS,-0.4109052790414631
other:バルコニー,-0.42339126536384447
detail_position:板橋区,-0.4606012124118689
shuunou:シューズボックス,-0.4952650057918563
detail_position:国分寺å¸other:ベランダ,0.8264951468218265
kaisou:B1,0.7796686417277474
secure:オートロック,0.7604581982615662
detail_position:台東区,0.6659183317945979
chikunen:0,0.6136048454528769
chikunen:15,0.5931677482457476
detail_position:中野区,0.5911471357392429
detail_position:江東区,0.5739366120873277
detail_position:杉並区,0.5728921124993623
kitchen:温水洗浄便座,0.4474801626848156
shuunou:ロフト,0.42151927542091794
kitchen:衛生的,0.3920513455017749
houi:西,0.3741114846955624
kouzou:鉄骨鉄筋コンクリート造,0.3535697833323608
detail_position:大田区,0.3446586070339472
kouzou:鉄筋コンクリート造,0.3138263818997952
houi:南西,0.3070655383769824
chikunen:5,0.2872295773377619
houi:北,0.2430111101565041
houi:北西,0.22538697156103002
other:エアコン,0.214598359395952
houi:北東,0.2019387908058347
secure:フォン,0.11767470921099588
secure:モニター,0.10760266602047616
kitchen:洗面化粧台,0.09386361765736617
communication:CATV,0.08588877042436927
detail_position:墨田区,0.07435273587993882
houi:南東,0.06567765283157351
chikunen:25,0.04163851037231766
houi:東,0.022312889718227168
houi:南,0.020537979511120016
madori:4DK,0.018183746572967188
detail_position:武蔵野市,0.008761541089121668
communication:光ファイバー,0.0020836381637674532
other:フローリング,0.0014217187370673507
kouzou:RC一部鉄骨造,0.0011141801833333736
chikunen:30,-0.0038310153262207203
madori:3DK,-0.018725826607206113
detail_position:三鷹市,-0.030465068514671713
position:最上階,-0.036317707026152314
chikunen:20,-0.03728108028234185
kouzou:鉄骨ALC造,-0.05261171854885066
detail_position:西多摩郡日の出町,-0.09254411730203255
communication:インターネット接続,-0.15229034125557409
kaisou:1,-0.1916048681953941
kaisou:2,-0.2170161861080145
kouzou:鉄骨造,-0.21975388085454048
detail_position:調布市,-0.2857191103339406
chikunen:50,-0.2900593398685229
chikunen:35,-0.3145948553488358
kitchen:ガスコンロ,-0.36013020499800064
other:置き場,-0.36510006048479837
detail_position:国立市,-0.3700143541818775
secure:インターホン,-0.3717568934378133
detail_position:練馬区,-0.39350904017143734
kouzou:木造,-0.4040841512006783
communication:BS,-0.4109052790414631
other:バルコニー,-0.42339126536384447
detail_position:板橋区,-0.4606012124118689
shuunou:シューズボックス,-0.4952650057918563
detail_position:国寺市,-0.5065266468615736
chikunen:40,-0.5130378105858397
shuunou:押入れ,-0.5144046946556834
communication:地上デジタル,-0.5158508917896429
detail_position:羽村,-0.5313633732692655
detail_position:東大和市,-0.5496332927402392
chikunen:45,-0.571054320171754
detail_position:江戸川区,-0.5778274453726666
detail_position:西多摩郡瑞穂町,-0.5818125119004486
madori:1LDK,-0.6345099818437069
detail_position:立川市,-0.652336259631167
detail_position:東久留米市,-0.6616492054438354
detail_position:西東京市,-0.6622042526481365
detail_position:清瀬市,-0.7468339573740379
detail_position:稲城市,-0.7643671895890932
detail_position:多摩市,-0.7864673239095419
detail_position:昭島市,-0.8195067393870181
detail_position:府中市,-0.8324989143071708
detail_position:日野市,-0.838696546276983
kouzou:軽量鉄骨造,-0.8401391149710145
detail_position:東村,-0.9418654815536898
detail_position:小平市,-0.9934643422760436
detail_position:足立区,-1.0231100371128643
detail_position:福生市,-1.12983587346072
detail_position:葛飾区,-1.1745225251422715
madori:2DK,-1.2405136357433448
detail_position:武蔵村,-1.2610511080953712
detail_position:青梅市,-1.500116753296547
detail_position:町田市,-1.6250202634449233
detail_position:あきる野市,-1.6492145277802979
detail_position:八王子市,-1.881756660782594
madori:2K,-2.4215314703700543
madori:1DK,-3.321824101971508
madori:1K,-5.451100269697461
madori:1R,-5.54834127302119
`;
	let defs_split = defs.split('\n');
	
	var hash = new Object();
	for (idx in defs_split) {
		let line = defs_split[idx];
		var [prefix_suffix, score] = line.split(',');
		if(prefix_suffix.match(/chikunen/) || prefix_suffix.match(/kaisou/) || prefix_suffix.match(/__intercept__/)) {
			hash[prefix_suffix] = parseFloat(score);	
		} else {
			hash[prefix_suffix.split(':')[1]] = parseFloat(score);	
		}
	}
	return hash;
}
function replace_generic_madori_name(x) {
	var ret = "";
	if(x == "ワンルーム")  {
		ret = "1R";	
	}
	return ret;
}
function replace_generic_kaisou_name(x) {
	//if(x)
	//let xint = parseInt(x);
	x = x.split('階')[0];
	if(isNaN(x) == true ) {
		return "kaisou:" + x;
	} else {
		let x10 =  parseInt(x, 10);
		if(x10 >= 4 ) {
			return "kaisou:4階以上";
		} else {
			return "kaisou:" + x10.toString();
		}
	}

}

function parse_todofuken(x) {
	var match = x.match(/(...??[都道府県])(.+?郡.+?[町村]|.+?市.+?区|.+?[市区町村])(.+)/);
	let todofuken = match[1];
	let shichoson = match[2];
	console.log(match);
	return [todofuken, shichoson];
}

function predict(model, list) {
	var score = model['__intercept__'];
	for(idx in list) {
		console.log(list[idx],model[list[idx]]);
		if(model[list[idx]] == null) continue;
		score += model[list[idx]];
	}
	
	return score;
}
$(function () {
		hash = get_model_tokyo();
		let address = $("#chk-bkc-fulladdress").text().split('\n')[1].replace(/^\s{1,}/, "");
		let [todofuken, shichoson] = parse_todofuken(address);
		let houi = $("#chk-bkc-windowangle").text();
		let madori = replace_generic_madori_name( $("#chk-bkc-marodi").text().split("\n")[1].replace(/^\s{1,}/, "") );
		let chikunen = $("#chk-bkc-kenchikudate").text().replace(/^\s{1,}/, "");
		let space_size = $("#chk-bkc-housearea").text().replace(/m.*?$/, "").replace(/^\s{1,}/,"");
		
		var detail_text = $("#chk-bkf-setsubi1").text() + 
											$("#chk-bkf-setsubi2").text() + 
											$("#chk-bkf-setsubi3").text() + 
											$("#chk-bkf-setsubi4").text() + 
											$("#chk-bkf-setsubi5").text();
		detail_text = detail_text.replace(/\s{1,}/g, "").replace(/\n/g, "");	
		let details = detail_text.split('、');

		let kouzou = $("#chk-bkd-housekouzou").text();
		let kaisou = replace_generic_kaisou_name($("#chk-bkd-housekai").text());
		console.log(hash);
		console.log(kaisou);
		let score = predict(hash, [kaisou, details, houi, madori, kouzou].flat());
		console.log(score);
		
		$("#chk-bkc-moneyroom").append(
			"<div class='num'> 機械学習score:" + score.toFixed(2) + "</div>"
		);
		/*
		console.log(details);
		console.log("houi:"+houi);
		console.log("madori:"+madori);
		console.log("full addr:"+address);
		console.log("space_size:"+space_size);
		console.log("detail_text:"+details);
		console.log("kouzou"+kouzou);
		console.log("kaisou"+kaisou);
		*/
});
